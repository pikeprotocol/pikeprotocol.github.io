(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ce39017"],{bce4:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"members-wrapper"},[a("div",{staticClass:"kong"}),t.isMember?a("div",{staticClass:"levelTitle"},[t._v(" "+t._s(t.$t("Current level"))+" "+t._s(t.data.level_current_name)+" ")]):t._e(),t.isMember?a("div",{staticClass:"level-wrapper"},[a("div",{staticClass:"tit"},[t._v(t._s(t.$t("Upgrade cost")))]),a("div",{staticClass:"valus"},[t._v("$ "+t._s(t.upgrade_amount))]),a("div",{staticClass:"valus valus2"},[t._v("PIKE "+t._s(t.pike_value))]),a("div",{staticClass:"valus valus2"},[t._v("ETH "+t._s(t.eth_value))]),a("div",{staticClass:"steps"},[a("div",{staticClass:"progress"},[a("van-slider",{attrs:{"bar-height":"10","button-size":"20"},on:{change:t.onChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),a("div",{staticClass:"flex insa"},t._l(t.data.level,(function(e,i){return a("div",{key:i,class:"v"+e.id},[t._v(" "+t._s(e.name)+" ")])})),0)])]):t._e(),a("van-radio-group",{model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[a("van-cell-group",[a("van-cell",{attrs:{title:"PIKE",clickable:""},on:{click:function(e){t.payType="PIKE"}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[a("van-radio",{attrs:{name:"PIKE"}})]},proxy:!0}])}),a("van-cell",{attrs:{title:"ETH",clickable:""},on:{click:function(e){t.payType="ETH"}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[a("van-radio",{attrs:{name:"ETH"}})]},proxy:!0}])})],1)],1),a("div",{staticClass:"bns",on:{click:function(e){return t.upgrade()}}},[t._v(t._s(t.$t("Confirm upgrade")))])],1)},s=[],n=a("ed3a"),o=n["a"],r=(a("de19"),a("2877")),l=Object(r["a"])(o,i,s,!1,null,null,null);e["default"]=l.exports},d5a7:function(t,e,a){},de19:function(t,e,a){"use strict";a("d5a7")},ed3a:function(module,__webpack_exports__,__webpack_require__){"use strict";var vuex__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("2f62");__webpack_exports__["a"]={data(){return{payType:"PIKE",chooseIndex:0,isMember:!0,value:0,upgrade_amount:"0.00",upgrade_level:0,loading:null,map_level:[{id:0,value:0},{id:1,value:22},{id:2,value:48},{id:3,value:72},{id:4,value:100}],data:{level:[],level_current_name:"",level_current_id:"0"}}},computed:{...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])("i18n",["locale"]),...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])(["web3","contracts"]),...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])("common",["balances","tokens"]),eth_value(){if(this.web3 instanceof Object){var t=this.tokens.find(t=>"ETH"==t.name);return null==t?"0.00000":((parseFloat(this.upgrade_amount)+.2)/t.price).toFixed(6)}return"0.00000"},pike_value(){if(this.web3 instanceof Object){var t=this.tokens.find(t=>"PIKE"==t.name);return null==t?"0.00000":((parseFloat(this.upgrade_amount)+.2)/t.price).toFixed(6)}return"0.00000"},upgrade_token_amount(){var t=this.tokens.find(t=>t.name==this.payType);if(null==t)return"0.00000";var e=(parseFloat(this.upgrade_amount)+.2)/t.price;return this.$helper.numToString(e*10**t.decimals)}},watch:{locale(){this.initPage()},"contracts.bank":{handler(t){this.initData()}}},mounted(){this.initPage(),this.contracts.bank instanceof Object&&this.initData()},beforeDestroy(){null!=this.loading&&this.loading.clear()},methods:{initPage(){this.$store.commit("website/SET_PAGE_TITLE",this.$t("Upgrade"))},async initData(){var t=this.$toast.loading({forbidClick:!0,duration:0});this.axios.get("/v1/site/upgrade").then(e=>{this.data=e.data;var a=parseInt(this.data.level_current_id)+1;a>4&&(a=4,this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Currently the highest level")}).then(t=>{this.$router.go(-1)})),this.upgrade_level=a;var i=this.data.level.find(t=>t.id==a);this.upgrade_amount=i.amount;var s=this.map_level.find(t=>t.id==a);this.value=s.value,t.clear(),null!=e.data.tx&&(this.loading=this.$toast.loading({message:this.$t("Confirming the upgrade"),forbidClick:!1,duration:0}),this.receipt(e.data.tx))}).catch(e=>{t.clear()})},receipt(t){this.web3.eth.getTransactionReceipt(t).then(e=>{if(null!=e){this.loading.clear();var a=this.contracts.bank._address.toLowerCase(),i=e.to.toLowerCase();i==a?this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Confirm success")}):(this.initData(),this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Please upgrade again")}))}else setTimeout(()=>{this.receipt(t)},1e3)})},onChange(t){let e=Math.floor(t);this.value=e<=11?0:e<=35&&e>11?22:e<=60&&e>35?48:e<=84&&e>60?72:100;var a=this.map_level.find(t=>t.value==this.value),i=this.data.level.find(t=>t.id==a.id);if(i.id<=parseInt(this.data.level_current_id)){var s=parseInt(this.data.level_current_id)+1;s>=4&&(s=4),i=this.data.level.find(t=>t.id==s);var n=this.data.level.find(t=>t.id==s);this.upgrade_amount=n.amount;var o=this.map_level.find(t=>t.id==s);this.value=o.value}this.upgrade_level=i.id,this.upgrade_amount=i.amount},chooseDd(t){this.chooseIndex=t},async getTokenBalance(){var t=this.tokens.find(t=>t.name==this.payType);if(null!=this.contracts.bank)return"ETH"==t.name?await this.web3.eth.getBalance(this.web3.eth.defaultAccount):await this.contracts.bank.methods.balanceOf(t.token_1,this.web3.eth.defaultAccount).call()},async upgrade(){var token=this.tokens.find(t=>t.name==this.payType),amount=this.upgrade_token_amount,options={from:this.web3.eth.defaultAccount,value:"0"},balance=await this.getTokenBalance();if(parseFloat(balance)<parseFloat(this.amount))return this.$toast(this.$t("Your balance is insufficient"));if("ETH"==this.payType)options.value=amount,this.payment(options,token,amount);else{var tokenName=token.name.toLowerCase(),contract;eval("contract = this.contracts."+tokenName),contract.methods.allowance(this.web3.eth.defaultAccount,this.contracts.funds._address).call((t,e)=>{parseFloat(e)>=parseFloat(amount)?this.payment(options,token,amount):this.approve(options,token,amount)})}},approve(options,token,amount){var tokenName=token.name.toLowerCase(),contract;options.value="0";var toast=this.$toast.loading({message:this.$t("Quantity approval confirmation, please wait"),forbidClick:!0,duration:0});eval("contract = this.contracts."+tokenName),contract.methods.approve(this.contracts.funds._address,amount).send(options,(t,e)=>{}).on("receipt",t=>{toast.clear(),this.payment(options,token,amount)}).on("error",t=>{toast.clear()})},payment(t,e,a){var i=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.contracts.bank.methods.upgradeUser(e.token_1,a).send(t,(t,e)=>{t||setTimeout(()=>{i.clear(),this.$root.initData(),this.initData(),this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Payment is successful, please wait for confirmation")}).then(t=>{this.$router.go(-1)})},1e3)}).on("receipt",t=>{this.initData()}).on("error",t=>{i.clear()})}}}}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39d2e552"],{bce4:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"members-wrapper"},[a("div",{staticClass:"kong"}),t.isMember?a("div",{staticClass:"levelTitle"},[t._v(" "+t._s(t.$t("Current level"))+" "+t._s(t.data.level_current_name)+" ")]):t._e(),t.isMember?a("div",{staticClass:"level-wrapper"},[a("div",{staticClass:"tit"},[t._v(t._s(t.$t("Upgrade cost")))]),a("div",{staticClass:"valus"},[t._v("$ "+t._s(t.upgrade_amount))]),a("div",{staticClass:"valus valus2"},[t._v("ETH "+t._s(t.eth_value))]),a("div",{staticClass:"steps"},[a("div",{staticClass:"progress"},[a("van-slider",{attrs:{"bar-height":"10","button-size":"20"},on:{change:t.onChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),a("div",{staticClass:"flex insa"},t._l(t.data.level,(function(e,i){return a("div",{key:i,class:"v"+e.id},[t._v(" "+t._s(e.name)+" ")])})),0)])]):t._e(),a("div",{staticClass:"bns",on:{click:function(e){return t.upgrade()}}},[t._v(t._s(t.$t("Confirm upgrade")))])])},s=[],l=a("2f62"),n={data(){return{chooseIndex:0,isMember:!0,value:0,upgrade_amount:"0.00",upgrade_level:0,loading:null,map_level:[{id:0,value:0},{id:1,value:22},{id:2,value:48},{id:3,value:72},{id:4,value:100}],data:{level:[],level_current_name:"",level_current_id:"0"}}},computed:{...Object(l["d"])("i18n",["locale"]),...Object(l["d"])(["web3","contracts"]),...Object(l["d"])("common",["balances","tokens"]),eth_value(){if(this.web3 instanceof Object){var t=this.tokens.find(t=>"ETH"==t.name);return null==t?"0.00000":((parseFloat(this.upgrade_amount)+.2)/t.price).toFixed(6)}return"0.00000"}},watch:{locale(){this.initPage()},"contracts.bank":{handler(t){this.initData()}}},mounted(){this.initPage(),this.contracts.bank instanceof Object&&this.initData()},beforeDestroy(){null!=this.loading&&this.loading.clear()},methods:{initPage(){this.$store.commit("website/SET_PAGE_TITLE",this.$t("Upgrade"))},async initData(){var t=this.$toast.loading({forbidClick:!0,duration:0});this.axios.get("/v1/site/upgrade").then(e=>{this.data=e.data;var a=parseInt(this.data.level_current_id)+1;a>4&&(a=4,this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Currently the highest level")}).then(t=>{this.$router.go(-1)})),this.upgrade_level=a;var i=this.data.level.find(t=>t.id==a);this.upgrade_amount=i.amount;var s=this.map_level.find(t=>t.id==a);this.value=s.value,t.clear(),null!=e.data.tx&&(this.loading=this.$toast.loading({message:this.$t("Confirming the upgrade"),forbidClick:!1,duration:0}),this.receipt(e.data.tx))}).catch(e=>{t.clear()})},receipt(t){this.web3.eth.getTransactionReceipt(t).then(e=>{if(null!=e){this.loading.clear();var a=this.contracts.bank._address.toLowerCase(),i=e.to.toLowerCase();i==a?this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Confirm success")}):(this.initData(),this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Please upgrade again")}))}else setTimeout(()=>{this.receipt(t)},1e3)})},onChange(t){let e=Math.floor(t);this.value=e<=11?0:e<=35&&e>11?22:e<=60&&e>35?48:e<=84&&e>60?72:100;var a=this.map_level.find(t=>t.value==this.value),i=this.data.level.find(t=>t.id==a.id);if(i.id<=parseInt(this.data.level_current_id)){var s=parseInt(this.data.level_current_id)+1;s>=4&&(s=4),i=this.data.level.find(t=>t.id==s);var l=this.data.level.find(t=>t.id==s);this.upgrade_amount=l.amount;var n=this.map_level.find(t=>t.id==s);this.value=n.value}this.upgrade_level=i.id,this.upgrade_amount=i.amount},chooseDd(t){this.chooseIndex=t},upgrade(){var t=this.tokens.find(t=>"ETH"==t.name),e=parseInt(1.005*parseFloat(this.upgrade_amount)/parseFloat(t.price)*10**18).toString(),a={from:this.web3.eth.defaultAccount,value:e},i=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.contracts.bank.methods.upgradeUser().send(a,(t,a)=>{t||(this.$helper.cache.set("__upgrade_user_tx",{params:{who:this.web3.eth.defaultAccount,amount:e,tx:a}}),setTimeout(()=>{i.clear(),this.$root.initData(),this.initData(),this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Payment is successful, please wait for confirmation")}).then(t=>{this.$router.go(-1)})},1e3))}).on("receipt",t=>{this.initData()}).on("error",t=>{i.clear()})}}},r=n,d=(a("de19"),a("2877")),o=Object(d["a"])(r,i,s,!1,null,null,null);e["default"]=o.exports},d5a7:function(t,e,a){},de19:function(t,e,a){"use strict";var i=a("d5a7"),s=a.n(i);s.a}}]);
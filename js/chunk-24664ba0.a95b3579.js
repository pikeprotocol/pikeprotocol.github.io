(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24664ba0"],{"0351":function(module,__webpack_exports__,__webpack_require__){"use strict";var vuex__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("2f62");__webpack_exports__["a"]={data(){return{payType:"PIKE",has_tips:!0}},computed:{...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])("i18n",["locale"]),...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])(["web3","contracts"]),...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])("common",["identity","tokens","config"]),miner_price_value(){return 0==this.tokens.length||void 0==this.config?0:parseFloat(this.config.pool_mining_price)},eth_value(){if(0==this.tokens.length)return"0.00";if(void 0==this.config)return"0.00";var t=this.tokens.find(t=>"ETH"==t.name);return parseFloat((this.miner_price_value+1)/t.price).toFixed(6)},pike_value(){if(0==this.tokens.length)return"0.00";if(void 0==this.config)return"0.00";var t=this.tokens.find(t=>"PIKE"==t.name);return parseFloat((this.miner_price_value+1)/t.price).toFixed(6)},miner_amount(){var t=this.tokens.find(t=>t.name==this.payType);if(null==t)return 0;var e=(this.miner_price_value+1)/t.price;return this.$helper.numToString(e*10**t.decimals)}},watch:{locale(){this.initPage()},"identity.is_pool":{handler(t){if(1==t){if(0==this.has_tips)return;this.$dialog.alert({title:this.$t("Tips"),message:this.$t("You are already a mining pool, no need to repeat purchase")}).then(t=>{this.$router.go("-1")})}}}},mounted(){this.initPage()},methods:{initPage(){this.$store.commit("website/SET_PAGE_TITLE",this.$t("Subscription mining pool"))},validateMiner(){var t=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.axios.get("/v1/site/miner-validate",{params:{uid:this.web3.eth.defaultAccount,amount:this.miner_price_value}}).then(e=>{t.clear(),1==e.data.success?this.buyMiner():this.$dialog.alert({title:this.$t("Tips"),message:e.data.message}).then(t=>{this.$router.go(-1)})}).catch(e=>{t.clear()})},minerUnlock(){this.$helper.cache.set("__miner_unlock",{params:{uid:this.web3.eth.defaultAccount,token:""}})},async buyMiner(){var amount=this.miner_amount,balance=await this.getTokenBalance();if(parseFloat(balance)<parseFloat(this.active_amount))return this.$toast(this.$t("Your balance is insufficient"));if("ETH"==this.payType)this.payment();else{var token=this.tokens.find(t=>t.name==this.payType),tokenName=token.name.toLowerCase(),contract;eval("contract = this.contracts."+tokenName),contract.methods.allowance(this.web3.eth.defaultAccount,this.contracts.funds._address).call((t,e)=>{var i=e;parseFloat(i)>=parseFloat(this.active_amount)?this.payment():this.approve()})}},approve(){var token=this.tokens.find(t=>t.name==this.payType),options={from:this.web3.eth.defaultAccount,value:0},toast=this.$toast.loading({message:this.$t("Quantity approval confirmation, please wait"),forbidClick:!0,duration:0}),contract,tokenName=token.name.toLowerCase();eval("contract = this.contracts."+tokenName),contract.methods.approve(this.contracts.funds._address,this.miner_amount).send(options,(t,e)=>{}).on("receipt",t=>{toast.clear(),this.payment()}).on("error",t=>{toast.clear()})},payment(){var t={from:this.web3.eth.defaultAccount,value:this.miner_amount},e="0";"PIKE"==this.payType&&(t.value="0",e=this.miner_amount);var i=this.tokens.find(t=>t.name==this.payType),a=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.contracts.bank.methods.buyMiner(i.token_1,e).send(t,(t,e)=>{t||(this.has_tips=!1,setTimeout(()=>{a.clear(),this.$root.initData(),this.disabled_mining=!0,this.$helper.cache.set("_disabled_mining",!0),this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Payment is successful, please wait for confirmation")}).then(t=>{this.$router.go(-1)})},1e3))}).on("receipt",t=>{this.$root.initData(),this.disabled_mining=!0}).on("error",t=>{a.clear()})},async getTokenBalance(){var t=this.tokens.find(t=>t.name==this.payType);if(null!=this.contracts.bank)return"ETH"==t.name?await this.web3.eth.getBalance(this.web3.eth.defaultAccount):await this.contracts.bank.methods.balanceOf(t.token_1,this.web3.eth.defaultAccount).call()}}}},1895:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"members-wrapper"},[i("div",{staticClass:"level-wrapper"},[i("div",{staticClass:"tit"},[t._v(t._s(t.$t("Subscription mining pool")))]),i("div",{staticClass:"valus underline"},[t._v("$ "+t._s(t.miner_price_value))]),i("div",{staticClass:"valus valus2"},[t._v("PIKE "+t._s(t.pike_value))]),i("div",{staticClass:"valus valus2"},[t._v("ETH "+t._s(t.eth_value))])]),i("van-radio-group",{model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[i("van-cell-group",[i("van-cell",{attrs:{title:"PIKE",clickable:""},on:{click:function(e){t.payType="PIKE"}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[i("van-radio",{attrs:{name:"PIKE"}})]},proxy:!0}])}),i("van-cell",{attrs:{title:"ETH",clickable:""},on:{click:function(e){t.payType="ETH"}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[i("van-radio",{attrs:{name:"ETH"}})]},proxy:!0}])})],1)],1),i("div",{staticClass:"bns",on:{click:function(e){return t.validateMiner()}}},[t._v(t._s(t.$t("Buy")))])],1)},n=[],s=i("0351"),o=s["a"],r=(i("d418"),i("2877")),c=Object(r["a"])(o,a,n,!1,null,null,null);e["default"]=c.exports},"6eca":function(t,e,i){},d418:function(t,e,i){"use strict";var a=i("6eca"),n=i.n(a);n.a}}]);
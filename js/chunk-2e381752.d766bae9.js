(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e381752"],{"174a":function(t,a,e){"use strict";var s=e("35b9"),i=e.n(s);i.a},"35b9":function(t,a,e){},5431:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"repay-submit"},[e("div",{staticClass:"info-title"},[t._v(t._s(t.$t("Repay")))]),e("div",{staticClass:"remark-info"},[t._v(t._s(t.$t("Your transaction details")))]),e("div",{staticClass:"panel-wrapper"},[e("div",{staticClass:"list flex flexcenter align"},[e("div",{staticClass:"name"},[t._v(t._s(t.$t("Amount")))]),e("div",{},[e("p",{staticClass:"eth"},[t._v(t._s(t.data.repay_amount)+" "+t._s(t.token.name))]),e("p",[t._v("$"+t._s(t.data.repay_value))])])]),e("div",{staticClass:"list flex flexcenter"},[e("div",{staticClass:"name"},[t._v(t._s(t.$t("Outstanding balance")))]),e("div",{},[e("p",{staticClass:"eth"},[t._v(t._s(t.data.repay_wait)+" "+t._s(t.token.name))])])]),e("div",{staticClass:"list flex flexcenter"},[e("div",{staticClass:"name"},[t._v(t._s(t.$t("Current health factor")))]),e("div",{staticClass:"blue"},[t._v(t._s(t.data.health_factor))])]),e("div",{staticClass:"list flex flexcenter"},[e("div",{staticClass:"name"},[t._v(t._s(t.$t("Next fitness factor")))]),e("div",{staticClass:"blue"},[t._v(t._s(t.data.health_factor2))])])]),e("div",{staticClass:"btn-control"},[e("div",{staticClass:"confirmBtn",on:{click:function(a){return t.repayLock()}}},[t._v(t._s(t.$t("Submit")))]),e("div",{staticClass:"goBack",on:{click:function(a){return t.goBack()}}},[t._v(t._s(t.$t("Go back")))])])])},i=[],n=e("87cf"),o=n["a"],r=(e("174a"),e("2877")),c=Object(r["a"])(o,s,i,!1,null,null,null);a["default"]=c.exports},"87cf":function(module,__webpack_exports__,__webpack_require__){"use strict";var vuex__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("2f62");__webpack_exports__["a"]={data(){return{data:{data:{},timer_1:null,loading:null}}},computed:{...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])(["web3","contracts","status"]),...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])("common",["balances","config","tokens"]),token:{get(){return this.tokens.find(t=>t.id==this.$route.query.id)||!1},set(t){}},init_data(){return 0!=this.token&&null!=this.contracts.bank}},watch:{init_data:{handler(t){1==t&&this.repayNext()}}},mounted(){this.loading=this.$toast.loading({forbidClick:!0,duration:0}),1==this.init_data&&this.repayNext(),this.timer_1=setInterval(async()=>{var t=this.$helper.cache.get("__repay_approve",!1);t&&(this.repayToken(t),this.$helper.cache.set("__repay_approve",null))},1e3)},beforeDestroy(){this.token=!1,this.loading=null,clearInterval(this.timer_1)},methods:{async repayNext(){var t=this.$route.query.amount;if(0==parseFloat(t)||"NaN"==parseFloat(t).toString())return this.$toast(this.$t("Please enter the amount"));this.axios.post("/v1/site/repay-next",{id:this.$route.query.id,amount:t}).then(t=>{null!=this.loading&&(this.loading.clear(),this.loading=null),1==t.data.success?(this.data=t.data,1==t.data.repay_lock&&this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Operation in progress, please refresh later and try again")}).theh(()=>{this.$router.go(-1)})):this.$toast(t.data.message)}).catch(t=>{null!=this.loading&&(this.loading.clear(),this.loading=null)})},goBack(){this.$router.go(-1)},repayLock(){var t=this.$toast.loading({message:this.$t("Repayment verification"),forbidClick:!0,duration:0});this.axios.get("/v1/site/repay-lock",{params:{uid:this.web3.eth.defaultAccount,token:this.token.name}}).then(a=>{t.clear(),1==a.data.success?this.submitRepay():this.$dialog.alert({title:this.$t("Tips"),message:a.data.message}).theh(()=>{this.$router.go(-1)})}).catch(a=>{t.clear()})},repayUnlock(){this.$helper.cache.set("__repay_unlock",{params:{uid:this.web3.eth.defaultAccount,token:this.token.name}})},submitRepay(){if("ETH"==this.token.name)this.repayETH();else{var tokenName=this.token.name.toLowerCase();eval("this.contract = this.contracts."+tokenName),this.contract.methods.allowance(this.web3.eth.defaultAccount,this.contracts.funds._address).call((t,a)=>{a>=this.data.repay_wei?this.repayToken({token:this.token.token_1,amount:this.data.repay_wei}):this.repayApprove()})}},repayETH(){var t={from:this.web3.eth.defaultAccount,value:this.$helper.numToString(this.data.repay_amount*10**18)},a=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.contracts.bank.methods.repay(this.contracts.funds._address,"0").send(t,(t,e)=>{t||setTimeout(()=>{a.clear(),this.$toast(this.$t("Send successfully, please wait for confirmation")),this.$router.go(-2)},1e3)}).on("receipt",t=>{this.$toast(this.$t("Successful repayment"))}).on("error",t=>{a.clear(),this.repayUnlock()})},repayApprove(){var tokenName=this.token.name.toLowerCase();eval("this.contract = this.contracts."+tokenName);var options={from:this.web3.eth.defaultAccount,value:0},toast=this.$toast.loading({message:this.$t("Quantity approval confirmation, please wait"),forbidClick:!0,duration:0});this.contract.methods.approve(this.contracts.funds._address,this.data.repay_wei).send(options,(t,a)=>{}).on("receipt",t=>{toast.clear(),this.$helper.cache.set("__repay_approve",{token:this.token.token_1,amount:this.data.repay_wei})}).catch(t=>{toast.clear(),this.repayUnlock()})},async repayToken(t){var a={from:this.web3.eth.defaultAccount,value:0},e=t.token,s=t.amount,i=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.contracts.bank.methods.repay(e,s.toString()).send(a,(t,a)=>{t||setTimeout(()=>{i.clear(),this.$toast(this.$t("Send successfully, please wait for confirmation")),this.$router.go(-2)},1e3)}).on("receipt",t=>{this.$toast(this.$t("Successful repayment"))}).on("error",t=>{i.clear(),this.repayUnlock()})}}}}}]);
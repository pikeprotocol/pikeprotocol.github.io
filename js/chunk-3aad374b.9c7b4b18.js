(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3aad374b"],{5402:function(module,__webpack_exports__,__webpack_require__){"use strict";var vuex__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("2f62");__webpack_exports__["a"]={data(){return{payType:"PIKE",loading:null,data:{},gas:0,gasPrice:0,has_user:!0}},computed:{...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])(["web3","contracts"]),...Object(vuex__WEBPACK_IMPORTED_MODULE_0__["d"])("common",["balances","tokens","identity"]),token(){return this.tokens.find(t=>"ETH"==t.name)},gas_fee(){var t=this.web3.utils.fromWei(this.$helper.numToString(this.data.gas),"ether");if("ETH"==this.payType)return parseFloat(t).toFixed(6);var e=this.tokens.find(t=>"ETH"==t.name),a=this.tokens.find(t=>"PIKE"==t.name);return t=parseFloat(t)*e.price/a.price,parseFloat(t).toFixed(6)},active_amount(){var t=this.tokens.find(t=>t.name==this.payType);if(null==t)return"0.00000";var e=(parseFloat(this.data.fee)+.1)/t.price;return e+=parseFloat(this.gas_fee),this.$helper.numToString(e*10**t.decimals)},eth_value(){var t=this.tokens.find(t=>"ETH"==t.name);return null==t||void 0==this.data.fee?"0.00000":parseFloat((parseFloat(this.data.fee)+.1)/parseFloat(t.price)).toFixed(6)},pike_value(){var t=this.tokens.find(t=>"PIKE"==t.name);return null==t||void 0==this.data.fee?"0.00000":parseFloat((parseFloat(this.data.fee)+.1)/parseFloat(t.price)).toFixed(6)}},watch:{"contracts.bank":{handler(t){this.initData(),this.getUser()}}},mounted(){this.$store.commit("website/SET_PAGE_TITLE",this.$t("Activate user")),this.contracts.bank instanceof Object&&(this.initData(),this.getUser())},beforeDestroy(){null!=this.loading&&this.loading.clear()},methods:{async initData(){var t=this.$toast.loading({forbidClick:!0,duration:0});this.axios.get("/v1/site/active",{params:{pid:localStorage.getItem("__invite"),who:this.web3.eth.defaultAccount}}).then(e=>{t.clear(),1==e.data.success?(this.data=e.data,null!=e.data.tx&&(this.loading=this.$toast.loading({message:this.$t("Confirming activation"),forbidClick:!1,duration:0}),this.receipt(e.data.tx))):this.$toast(e.data.message)}).catch(e=>{t.clear()})},async getUser(){this.contracts.bank.methods.getUser(this.web3.eth.defaultAccount).call((t,e)=>{t||("0x0000000000000000000000000000000000000000"==e.id?this.has_user=!1:this.$router.go(-1))}).catch(t=>{})},receipt(t){this.web3.eth.getTransactionReceipt(t).then(e=>{if(null!=e){this.loading.clear();var a=this.contracts.bank._address.toLowerCase(),s=e.to.toLowerCase();s==a?this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Cannot be reactivated")}).then(t=>{this.$router.go(-1)}):this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Please reactivate")})}else setTimeout(()=>{this.receipt(t)},1e3)})},async beginActive(){var t=this.tokens.find(t=>t.name==this.payType),e=localStorage.getItem("__invite");if(null==e)return this.$toast(this.$t("The referrer does not exist, please revisit the address of your referrer"));var a=await this.getTokenBalance();if(parseFloat(a)<parseFloat(this.active_amount))return this.$toast(this.$t("Your balance is insufficient"));this.$dialog.confirm({title:this.$t("Tips"),message:this.$t("This operation requires payment of Oraclize fee {num}{token}",{num:this.gas_fee,token:t.name})}).then(t=>{this.active()}).catch(t=>{})},async active(){if("ETH"==this.payType)this.payment();else{var token=this.tokens.find(t=>t.name==this.payType),tokenName=token.name.toLowerCase(),contract;eval("contract = this.contracts."+tokenName),contract.methods.allowance(this.web3.eth.defaultAccount,this.contracts.funds._address).call((t,e)=>{parseFloat(e)>=parseFloat(this.active_amount)?this.payment():this.approve()})}},approve(){var token=this.tokens.find(t=>t.name==this.payType),tokenName=token.name.toLowerCase(),options={from:this.web3.eth.defaultAccount,value:0},toast=this.$toast.loading({message:this.$t("Quantity approval confirmation, please wait"),forbidClick:!0,duration:0}),contract;eval("contract = this.contracts."+tokenName),contract.methods.approve(this.contracts.funds._address,this.active_amount.toString()).send(options,(t,e)=>{}).on("receipt",t=>{toast.clear(),this.payment()}).on("error",t=>{toast.clear()})},payment(){var t=localStorage.getItem("__invite"),e=this.tokens.find(t=>t.name==this.payType),a=this.active_amount,s={from:this.web3.eth.defaultAccount,value:a.toString()};"PIKE"==e.name?s.value="0":a="0";var i=this.$toast.loading({message:this.$t("Being paid"),forbidClick:!0,duration:0});this.contracts.bank.methods.activeUser(e.token_1,t,a).send(s,(t,e)=>{t||(this.initData(),setTimeout(()=>{i.clear(),this.$dialog.alert({title:this.$t("Tips"),message:this.$t("Payment is successful, please wait for confirmation")}).then(t=>{this.$router.go(-1)})},1e3))}).on("receipt",t=>{this.initData()}).on("error",t=>{i.clear()})},async getTokenBalance(){var t=this.tokens.find(t=>t.name==this.payType);if(null!=this.contracts.bank)return"ETH"==t.name?await this.web3.eth.getBalance(this.web3.eth.defaultAccount):await this.contracts.bank.methods.balanceOf(t.token_1,this.web3.eth.defaultAccount).call()}}}},6630:function(t,e,a){"use strict";var s=a("e9c7"),i=a.n(s);i.a},"82e6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"members-wrapper"},[a("div",{staticClass:"level-wrapper"},[a("div",{staticClass:"tit"},[t._v(t._s(t.$t("Activation fee")))]),a("div",{staticClass:"valus underline"},[t._v("$ "+t._s(t.data.fee))]),a("div",{staticClass:"valus valus2"},[t._v("PIKE "+t._s(t.pike_value))]),a("div",{staticClass:"valus valus2"},[t._v("ETH "+t._s(t.eth_value))])]),a("van-radio-group",{model:{value:t.payType,callback:function(e){t.payType=e},expression:"payType"}},[a("van-cell-group",[a("van-cell",{attrs:{title:"PIKE",clickable:""},on:{click:function(e){t.payType="PIKE"}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[a("van-radio",{attrs:{name:"PIKE"}})]},proxy:!0}])}),a("van-cell",{attrs:{title:"ETH",clickable:""},on:{click:function(e){t.payType="ETH"}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[a("van-radio",{attrs:{name:"ETH"}})]},proxy:!0}])})],1)],1),a("button",{class:{bns:!0,disable:t.has_user},attrs:{disabled:t.has_user},on:{click:function(e){return t.beginActive()}}},[t._v(" "+t._s(t.$t("Confirm activation"))+" ")])],1)},i=[],n=a("5402"),o=n["a"],r=(a("6630"),a("2877")),c=Object(r["a"])(o,s,i,!1,null,null,null);e["default"]=c.exports},e9c7:function(t,e,a){}}]);